<div class="max-w-5xl mx-auto py-6">
    <header class="text-center mb-10">
        <h2 class="text-3xl font-black text-slate-800 mb-3">
            <i class="fa-solid fa-clock text-brand-red mr-3"></i>夥伴職能儀表板
        </h2>
        <p id="page-subtitle" class="text-slate-500 font-bold">晉升進度公開透明 (招募展示模式)</p>
    </header>

    <div class="bg-white rounded-3xl shadow-lg border border-slate-100 overflow-hidden relative min-h-[400px]">
        
        <div id="demo-table-view" class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-slate-50 border-b border-slate-100 text-slate-500 text-sm uppercase tracking-wider">
                        <th class="p-4 font-bold text-center">職級 (Level)</th>
                        <th class="p-4 font-bold">夥伴姓名</th>
                        <th class="p-4 font-bold text-center">累積時數</th>
                        <th class="p-4 font-bold text-center">下階段目標</th>
                        <th class="p-4 font-bold text-center">目前狀態</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100 text-slate-700 font-bold">
                    <tr class="hover:bg-red-50 transition-colors bg-red-50/30">
                        <td class="p-4 text-center"><span class="bg-brand-red text-white px-3 py-1 rounded-full text-xs shadow-sm">Level 3</span></td>
                        <td class="p-4 flex items-center gap-2"><div class="w-8 h-8 rounded-full bg-brand-red text-white flex items-center justify-center text-xs">王</div><span>王Ｏ明 (店長範例)</span></td>
                        <td class="p-4 text-center font-mono text-brand-red">1,280 H</td>
                        <td class="p-4 text-center text-xs text-slate-400">已達最高職級</td>
                        <td class="p-4 text-center"><span class="text-brand-red text-xs border border-brand-red px-2 py-1 rounded">Core Partner</span></td>
                    </tr>
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="p-4 text-center"><span class="bg-brand-gold text-white px-3 py-1 rounded-full text-xs shadow-sm">Level 2</span></td>
                        <td class="p-4 flex items-center gap-2"><div class="w-8 h-8 rounded-full bg-brand-gold text-white flex items-center justify-center text-xs">陳</div><span>陳Ｏ豪 (資深範例)</span></td>
                        <td class="p-4 text-center font-mono text-slate-600">425 H</td>
                        <td class="p-4 text-center text-xs text-slate-400">目標 450 H<div class="w-24 h-1.5 bg-slate-100 rounded-full mx-auto mt-1 overflow-hidden"><div class="h-full bg-brand-gold" style="width: 94%"></div></div></td>
                        <td class="p-4 text-center text-green-600 text-sm"><i class="fa-solid fa-arrow-trend-up mr-1"></i>即將晉升</td>
                    </tr>
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="p-4 text-center"><span class="bg-slate-400 text-white px-3 py-1 rounded-full text-xs shadow-sm">Level 1</span></td>
                        <td class="p-4 flex items-center gap-2"><div class="w-8 h-8 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center text-xs">林</div><span>林Ｏ婷 (新人範例)</span></td>
                        <td class="p-4 text-center font-mono text-slate-600">86 H</td>
                        <td class="p-4 text-center text-xs text-slate-400">目標 150 H<div class="w-24 h-1.5 bg-slate-100 rounded-full mx-auto mt-1 overflow-hidden"><div class="h-full bg-slate-400" style="width: 57%"></div></div></td>
                        <td class="p-4 text-center text-slate-400 text-sm">培訓中</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="loader-view" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-10 hidden">
            <i class="fas fa-circle-notch loading-spinner text-4xl text-brand-gold mb-4"></i>
            <p class="text-slate-400 font-bold">正在同步 Google 試算表...</p>
        </div>
        
        <div id="real-data-container" class="overflow-x-auto hidden">
            </div>

    </div>
    
    <div class="mt-6 text-center" id="footer-note">
        <p class="text-xs text-slate-400"><i class="fa-solid fa-shield-halved mr-1"></i>隱私保護：本頁面為招募展示模式，數據為虛構範例。</p>
    </div>
</div>

<img src="" onerror="initDashboard()" style="display:none;">

<script>
    function initDashboard() {
        // 設定區：您的 Google Sheet CSV 網址
        // 請注意：網址裡的 0kJx9 是數字0還是英文O，請確認您的原始連結，這裡先依照您提供的貼上
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSPKyIVGlT4rmWEOUPwSdccHGWEaGPF3QhMm0rXnh7g_0kJx9iXFzIGVoY_uWOUHN9La8KjZOp5BMAv/pub?gid=1723033779&single=true&output=csv";
        
        // 核心邏輯：檢查網址有沒有 "demo"
        // 只要網址裡出現 "demo" (例如 ?demo=1)，就當作是 Demo 模式
        const isDemoMode = window.location.href.indexOf('demo') !== -1;

        if (isDemoMode) {
            // === 情況 1：如果是招募模式 ===
            // 什麼都不做！直接結束程式 (return)。
            // 因為 HTML 本身就是範例表格，所以畫面會停在安全的狀態。
            console.log("偵測到 Demo 模式，停止連線，顯示範例。");
            return; 
        }

        // === 情況 2：只有網址乾淨時，才執行連線 ===
        console.log("準備連線 Google Sheet...");

        // 切換畫面：隱藏範例 -> 顯示讀取中
        document.getElementById('demo-table-view').classList.add('hidden');
        document.getElementById('loader-view').classList.remove('hidden');
        document.getElementById('page-subtitle').innerText = "即時同步 Google 試算表數據";
        document.getElementById('footer-note').innerHTML = '<p class="text-xs text-slate-400"><i class="fa-solid fa-circle-info mr-1"></i>資料來源：GYOSEN PT MASTER SHEET</p>';

        // 開始抓資料
        fetch(CSV_URL)
            .then(response => response.text())
            .then(csvText => {
                const rows = csvText.trim().replace(/\r/g, '').split('\n');
                const headers = rows[0].split(',');
                
                // 轉換 CSV 資料
                const data = rows.slice(1).map(row => {
                    const values = row.split(',');
                    return headers.reduce((obj, header, index) => {
                        obj[header] = values[index];
                        return obj;
                    }, {});
                });

                // 產生真實表格 HTML
                let html = `
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-slate-50 border-b border-slate-100 text-slate-500 text-sm uppercase tracking-wider">
                            <th class="p-4 font-bold">姓名</th>
                            <th class="p-4 font-bold text-center">職級</th>
                            <th class="p-4 font-bold text-center">時數</th>
                            <th class="p-4 font-bold text-center">狀態</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100 text-slate-700 font-bold">`;

                data.forEach(item => {
                    // 自動抓取對應欄位 (防呆機制)
                    const name = item['姓名'] || item['Name'] || Object.values(item)[0] || 'Unknown';
                    const level = item['職級'] || item['Level'] || '';
                    const hours = item['時數'] || item['Hours'] || '0';
                    const status = item['狀態'] || item['Status'] || '';

                    html += `
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="p-4">${name}</td>
                        <td class="p-4 text-center"><span class="bg-slate-100 px-2 py-1 rounded text-xs">${level}</span></td>
                        <td class="p-4 text-center font-mono text-brand-red">${hours} H</td>
                        <td class="p-4 text-center text-xs text-slate-400">${status}</td>
                    </tr>`;
                });

                html += `</tbody></table>`;

                // 顯示結果
                document.getElementById('real-data-container').innerHTML = html;
                document.getElementById('loader-view').classList.add('hidden');
                document.getElementById('real-data-container').classList.remove('hidden');
            })
            .catch(error => {
                console.error("連線失敗:", error);
                // 萬一連線失敗，為了安全，切換回範例
                alert("無法讀取資料，將顯示範例模式");
                document.getElementById('loader-view').classList.add('hidden');
                document.getElementById('demo-table-view').classList.remove('hidden');
            });
    }
</script>
